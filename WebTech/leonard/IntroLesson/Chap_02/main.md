# 传输与分组

## 传输介质

数据通信系统的三个基本要素: 信源, 信宿, 信道

信道是传送信号的通路. 在网络最底层, 所有通信都要进行某种能量形式的编码, 并通过传输介质将能量发送出去. 对数据的编码和译码由计算机硬件设备完成.

**数据** 是传递信息的实体, 可分为模拟数据和数字数据两大类. 
**信号** 是数据的电编码, 电磁编码或光编码. 有模拟信号和数字信号两种基本形式

### 模拟与数字

-  模拟数据反映的是 **连续信息**. 取值连续, 如传统的语音和图像
-  数字数据反映 **离散信息**, 如字母, 符号
-  模拟信号在某一数值范围内连续取值
-  数字信号只能离散取值.

1.  **导线**: 为了降低干扰, 使用非屏蔽双绞线(UTP), 屏蔽双绞线(STP), 同轴电缆三种基本布线
    -  **双绞线(Twisted Pair)**: 每对双绞线由绞合在一起的相互绝缘的两根铜线组成. 两根导线电气性能相同保持平衡, 可以抵消掉相互之间的辐射从而提高传输质量.
    -  **非屏蔽双绞线**: 传输距离一般为100m, 性价比高
       -  3类线: 传输频率16MHz, 最高传输速率10Mbps
       -  5类线: 增加绕线密度, 使用高质量绝缘材料. 频率与最高速率:(10MHz, 100Mbps)
       -  超5类线: 进行了一定改善(相对5), 速率仍为100Mbps或125Mbps
       -  6类线: 参数大幅提高, 带宽扩展为250MHz, 最大速率 1000Mbps
       -  7类线: 在ISO 7类/F级标准中给出定义, 但它是屏蔽式的. 频率可达 600MHz, 速率可到10Gbps. 但价格昂贵, 工艺复杂, 布线复杂. 尚未成为主流方案(2021)
    -  **屏蔽双绞线**: 非屏蔽双绞线传输信息时会向周围辐射, 一方面造成损耗, 另一方面容易被窃听. 一般使用铝箔包裹, 但无法完全消除辐射. 

    -  **同轴电缆**: 中心轴线是一条铜导线, 外加一层绝缘材料. 其外是一根空心圆柱网状铜导体包裹, 最外一层为绝缘层. 
       相对双绞线, 抗干扰能力强, 屏蔽性能好, 数据传输稳定且传输距离较远.

       -  75 Omega: CATV网
       -  50 Omega: 主要用于基带信号传输.

2.  **光纤**: 细小光纤被封装于塑料护套内, 能弯曲也不至于断裂. 
    优点: 不易被干扰, 损耗较小, 传输距离远, 单根光纤即可完成光传输
    缺点: 必须保证光线端面光滑, 损坏相对不易排查

    -  应用: 通常用于主干网中. 波分多路复用技术可以支持1600 = (160 * 10)Gbps传输 (2021). 快速以太网, 千兆以太网等

3.  **无线介质**
    目前(2021), 主流使用 无线电(射频技术+人造卫星), 微波(5G, 蓝牙), 红外线(电视遥控器), 激光.
    -  无线电通信: 低频 (<2Mbit/s>) 沿地表传播, 会被不平坦的地形阻碍. 中频 (2-30Mbit/s) 可被电离层反射. 高频 (>30 Mbit/s) 直线传播而且会被障碍物阻断. 无线网络技术的频率不能随意选择, 政府管制频谱使用. 
    -  卫星通信: 低轨道: 延时低, 存在相对运动. 中轨道: 提供两极通信. 静止轨道: 相对静止但延迟大. 理论上至少需要3个卫星覆盖

### 介质选择的评估因素

1.  费用: 材料, 安装和维护
2.  数据速率: 每秒传输比特数
3.  时延: 信号处理和传输需要的时间
4.  信号影响: 衰减和失真
5.  环境: 干扰, 电气噪声
6.  安全: 对窃听的敏感性 (民用考虑上层加密)

## 局域异步通信

广义上讲, 如果发送方和接收方在发送信息之前无需进行时钟同步, 则为 **异步(asynchronous)**. 技术上讲, 如果两次传输间隔任意即为异步. 

### RS-232 标准

全称 RS-232-C 标准, 由EIA发布于1969年. 事实上的厂商之间的局域异步串行通信的标准. 

考虑了实际硬件的缺陷, 说明了发送器必须同理论波形相差低于多少, 以及接收器容差.

为了提高传输速率, 可以缩短每个信号电平的持续时间. 事实上接收端检测要求一个最小时间, 发送端也不可能无限快地改变电压.

### 硬件带宽

每个传输系统都有自己的模拟带宽, 称为硬件带宽.

Nyquist 定理: 带宽为 B, 使用 K种电压进行数据编码的传输系统上, 最大数据传输速率D(每秒位数)为

$$
D = 2 B \log_2 K
$$

如果考虑噪声的影响, 给出Shannon定理:

$$
C = B \log_2 ( 1 + S / N)
$$

C为每秒位数表示的信道容量的实际限制值, B为带宽, S为平均信号功率, N为平均噪声功率

## 远距离通信

信号在传输过程中总会出现衰减, 从而不可能无限距离传输. 对于电信号, 连续的震荡信号比其他信号能传播更远距离, 这一发现是绝大多数远距离通信系统的基础. 

在空载情况下传输信号仍然是高频振荡的, 被称为载波

### 调制(Modulation)

为了发送数据, 发送器需要对载波做出调整. 
1.  调幅: 使载波信号强度随信息变化
2.  调频: 使载波信号频率随信息变化

调幅和调频没传送一位, 都至少需要一个载波周期. 

更高效的移相调制技术: 通过突然改变载波的相位来编码数据. 

也可以移相调制和调幅结合使用: 正交调制技术

### 解调(Demodulation)

接收器需要对接收到的信号进行操作恢复调制加载的信息.

## 编码

1.  **NRZ(Non-Return to Zero)**. 高信号编码1, 低信号编码0
    -  一长串0/1会引起基线漂移(baseline wander). 接收方需要保持一个它看到的信号的平均值, 以此区分高低信号. 
    -  时钟漂移: 无论何时, 只要有信号有0-1的跳变, 接收方就知道这出现在时钟周期的边界. 如果长时间没有跳变那么会导致时钟漂移, 使得接收方和发送方不再同步.

2.  **NRZI(Non-Return to Zero Inverted)**. 0-保持当前信号, 1-发送方以当前信号的一个跳变编码1. 即高低对应接收方接收到的相对信号. 
    -  解决了连续1出现的问题, 但没有解决连续0.

3.  **Manchester Encoding**. 通过传输NRZ编码数据和时钟的异或值使得时钟和信号合并: 0-从低到高跳变, 1-从高到低跳变.
    -  可以有效恢复时钟, 同时没有基线漂移
    -  信号跳变速率加倍. 比特率是波特率(单位时间产生信号变化的次数)的一半, 效率下降. 
    -  早期技术使用, 因为时钟同步不精确.

4.  **Differential Manchester**. 0-信号前一半和前一比特信号后一半相反. 1-信号前一半和前一比特信号后一半相同.
    -  比 Manchester 变化要少, 更适合高速传输
    -  即使偶尔把输送信号的两个导线弄反, 编码结果依然正确.

5.  **4B/5B Encoding**. 解决基线漂移和时钟漂移同时, 尽可能提高编码效率. 思想: 在比特流中插入额外比特打破一串0/1. 方法: 用5个比特编码4个比特数据, 然后发给接收方.

## 分组, 帧和差错检测

使发送方和接收方协调, 多数计算机网络把数据分成 “packet” 的小块, 计算机通过共享资源轮流发送 packet.

使用术语 帧 (frame) 来指数据链路层(网络接口层)中特定的分组格式. 每种网络技术都会确切定义网络所采用的帧的细节, 如其大小和格式.

检错和纠错能力是用信息量的冗余和系统效率的降低为代价换取的.